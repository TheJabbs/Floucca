(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[857],{1196:function(e,t,a){Promise.resolve().then(a.bind(a,6644))},6644:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var r=a(7437),s=a(2265),n=a(6522),c=a(2203);let o=e=>new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),i=e=>new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e);var l=e=>{let{title:t,columns:a,data:s,isLoading:n,noDataMessage:c="No data available",keyExtractor:l}=e,d=(e,t)=>{if(e.format)return e.format(t);if("number"==typeof t){if(e.key.toLowerCase().includes("price")||e.key.toLowerCase().includes("value"))return o(t);if(t%1!=0)return i(t)}return t};return(0,r.jsxs)("div",{children:[t&&(0,r.jsx)("h3",{className:"text-lg font-semibold mb-3",children:t}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsx)("tr",{children:a.map(e=>(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.header},e.key))})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:n?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:a.length,className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center",children:(0,r.jsx)("div",{className:"flex justify-center py-4",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})})})}):s&&0!==s.length?s.map((e,t)=>(0,r.jsx)("tr",{children:a.map(a=>(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:d(a,e[a.key])},"".concat(t,"-").concat(a.key)))},l?l(e):t)):(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:a.length,className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center",children:c})})})]})})]})},d=e=>{let{isLoading:t,effortData:a}=e;return(0,r.jsx)(l,{title:"Effort (WEEKLY)",columns:[{key:"records",header:"Records"},{key:"gears",header:"Boats/Gears"},{key:"activeDays",header:"Active Days"},{key:"pba",header:"PBA"},{key:"estEffort",header:"Estimated Effort"}],data:a?[a]:[],isLoading:t,noDataMessage:"No effort data available."})},u=e=>{let{isLoading:t,landingsData:a}=e;return(0,r.jsx)(l,{title:"Landings",columns:[{key:"records",header:"Records"},{key:"avgPrice",header:"Average Price"},{key:"estValue",header:"Estimated Value"},{key:"cpue",header:"CPUE"},{key:"estCatch",header:"Estimated Catch"},{key:"sampleEffort",header:"Sample Effort"}],data:a?[a]:[],isLoading:t,noDataMessage:"No landings data available."})},h=a(1443),g=a(9247),p=e=>{let{data:t,isLoading:a}=e,[n,c]=(0,s.useState)("estCatch"),o=e=>null!==e?e.toFixed(2):"N/A",i=e=>null!==e?"".concat(new Intl.NumberFormat("en-US").format(e)," LBP"):"N/A",l={estCatch:"#a855f7",price:"#10b981",cpue:"#f59e0b"},d=s.useMemo(()=>({yAxis:[{label:""}],height:400,sx:{[".".concat(g.x.left," .").concat(g.x.label)]:{transform:"translate(-20px, 0)"}}}),[n]);if(a)return(0,r.jsx)("div",{className:"flex justify-center py-10",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"})});if(!t||0===t.length)return(0,r.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg text-gray-500 text-center",children:"No data available for chart visualization"});let{dataset:u,series:p}=(()=>{if(!t||0===t.length)return{dataset:[],series:[]};let e=t.map(e=>({species:e.species,estCatch:e.estCatch,price:e.price,cpue:e.cpue})),a=[];return"estCatch"===n?a=[{dataKey:"estCatch",label:"Est. Catch",valueFormatter:o,color:l.estCatch}]:"price"===n?a=[{dataKey:"price",label:"Price",valueFormatter:i,color:l.price}]:"cpue"===n&&(a=[{dataKey:"cpue",label:"CPUE",valueFormatter:o,color:l.cpue}]),{dataset:e,series:a}})();return(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsxs)("div",{className:"mb-4 flex justify-center space-x-2",children:[(0,r.jsx)("button",{onClick:()=>c("estCatch"),className:"px-3 py-1.5 rounded-md text-sm font-medium ".concat("estCatch"===n?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800 hover:bg-gray-200"),children:"Est. Catch"}),(0,r.jsx)("button",{onClick:()=>c("price"),className:"px-3 py-1.5 rounded-md text-sm font-medium ".concat("price"===n?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800 hover:bg-gray-200"),children:"Price"}),(0,r.jsx)("button",{onClick:()=>c("cpue"),className:"px-3 py-1.5 rounded-md text-sm font-medium ".concat("cpue"===n?"bg-amber-100 text-amber-800":"bg-gray-100 text-gray-800 hover:bg-gray-200"),children:"CPUE"})]}),(0,r.jsx)("div",{className:"mx-auto",style:{width:"100%",maxWidth:"900px"},children:(0,r.jsx)(h.v,{dataset:u,xAxis:[{scaleType:"band",dataKey:"species",tickLabelStyle:{textAnchor:"middle",fontSize:14}}],series:p,...d})})]})},m=a(5457),f=e=>{let{isLoading:t,statsData:a}=e,[n,c]=(0,s.useState)(!1);return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Fishing Data"}),(0,r.jsxs)("button",{onClick:()=>{c(!n)},className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ".concat(n?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-700 hover:bg-gray-200"),title:n?"Hide chart view":"Show chart view",children:[(0,r.jsx)(m.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:n?"Hide Chart":"View Chart"})]})]}),(0,r.jsx)(l,{columns:[{key:"species",header:"Species"},{key:"averageWeight",header:"Aver.Weight (kg)"},{key:"fishCount",header:"N.fish in catch"},{key:"price",header:"Price"},{key:"value",header:"Value"},{key:"cpue",header:"CPUE"},{key:"estCatch",header:"Est. catch"}],data:a,isLoading:t,noDataMessage:"No species data available.",keyExtractor:e=>e.species}),n&&(0,r.jsx)(p,{data:a||[],isLoading:t})]})},x=a(4188);let y=async e=>{try{let t={period:e.period,gear_code:e.gear_code?e.gear_code:void 0,port_id:e.port_id?e.port_id:void 0,region:e.region?e.region:void 0,coop:e.coop?e.coop:void 0};return console.log("Sending filter to API:",t),(await x.x1.post("/api/dev/formulas/report/effort&landing",t)).data}catch(e){return(0,x.zG)(e,"fetching statistics data")}},b=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.map(e=>({species:t[e.specie_code]||"Species ".concat(e.specie_code),averageWeight:e.avg_fish_weight,fishCount:e.avg_fish_quantity,price:e.avg_price,value:e.fish_value,cpue:e.cpue,estCatch:e.est_catch}))};var v=()=>{let{gears:e,ports:t,formattedPeriods:a,species:o,isLoading:i,error:l}=(0,c.B)(),[h,g]=(0,s.useState)(""),[p,m]=(0,s.useState)(0),[x,v]=(0,s.useState)(0),[j,N]=(0,s.useState)({records:0,gears:0,activeDays:0,pba:0,estEffort:0}),[w,S]=(0,s.useState)({records:0,avgPrice:0,estValue:0,cpue:0,estCatch:0,sampleEffort:0}),[_,k]=(0,s.useState)([]),[C,E]=(0,s.useState)(!1),[F,P]=(0,s.useState)(!1),[D,L]=(0,s.useState)(!1),[I,A]=(0,s.useState)(null),z={};null==o||o.forEach(e=>{z[e.specie_code]=e.specie_name});let G=()=>""!==h&&0!==p&&0!==x,T=async()=>{if(G()){E(!0),P(!0),L(!0),A(null);try{let e=await y({period:h,gear_code:[p],port_id:[x]});N(e.uperTable.effort),S(e.uperTable.landings),k(b(e.lowerTable,z))}catch(e){console.error("Error fetching statistics:",e),A("string"==typeof e?e:"Failed to fetch statistics data")}finally{E(!1),P(!1),L(!1)}}};return((0,s.useEffect)(()=>{G()&&T()},[h,p,x]),i)?(0,r.jsx)("div",{className:"flex justify-center py-10",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"})}):l?(0,r.jsx)("div",{className:"container mx-auto p-6",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-800 p-4 rounded-lg",children:[(0,r.jsx)("p",{children:l}),(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-md",children:"Try Again"})]})}):(0,r.jsxs)("div",{className:"container mx-auto p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4 lg:mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Fishing Statistics"}),(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsxs)("button",{onClick:T,disabled:!G(),className:"px-3 py-1.5 rounded-lg flex items-center gap-1 text-sm ".concat(G()?"bg-blue-100 text-blue-800 hover:bg-blue-200":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:[(0,r.jsx)(n.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Refresh Data"})]})})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-4 lg:gap-6",children:[(0,r.jsx)("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"period",className:"block text-sm font-medium text-gray-700 mb-1",children:"Time Period"}),(0,r.jsxs)("select",{id:"period",value:h,onChange:e=>{g(e.target.value)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,r.jsx)("option",{value:"",children:"Select a period"}),[...a].sort((e,t)=>t.value.localeCompare(e.value)).map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"gear",className:"block text-sm font-medium text-gray-700 mb-1",children:"Gear Type"}),(0,r.jsxs)("select",{id:"gear",value:p,onChange:e=>{m(Number(e.target.value))},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,r.jsx)("option",{value:0,children:"Select a gear"}),e.map(e=>(0,r.jsx)("option",{value:e.gear_code,children:e.gear_name},e.gear_code))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"port",className:"block text-sm font-medium text-gray-700 mb-1",children:"Port"}),(0,r.jsxs)("select",{id:"port",value:x,onChange:e=>{v(Number(e.target.value))},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,r.jsx)("option",{value:0,children:"Select a port"}),t.map(e=>(0,r.jsx)("option",{value:e.port_id,children:e.port_name},e.port_id))]})]})]})}),I&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-800 p-4 rounded-lg",children:(0,r.jsx)("p",{children:I})}),G()?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg border shadow-sm overflow-x-auto",children:[(0,r.jsx)(d,{isLoading:C,effortData:j}),(0,r.jsx)("div",{className:"border-t border-gray-300 my-4"}),(0,r.jsx)(u,{isLoading:F,landingsData:w})]}),(0,r.jsx)("div",{className:"bg-white p-4 rounded-lg border shadow-sm overflow-x-auto",children:(0,r.jsx)(f,{isLoading:D,statsData:_})})]}):(0,r.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-100 text-blue-800 text-center",children:"Please select a time period, gear type, and port to view statistics."})]})]})}},6656:function(e,t,a){"use strict";function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36e5;try{let a=localStorage.getItem("".concat(e,"_timestamp"));if(!a)return!1;let r=parseInt(a,10);return Date.now()-r<t}catch(e){return console.error("Error checking cache validity:",e),!1}}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36e5;try{if(!r(e,t))return null;let a=localStorage.getItem(e);if(!a)return null;return JSON.parse(a)}catch(e){return console.error("Error retrieving from cache:",e),null}}function n(e,t){try{let a="".concat(e,"_timestamp");localStorage.setItem(e,JSON.stringify(t)),localStorage.setItem(a,Date.now().toString())}catch(e){console.error("Error saving to cache:",e)}}function c(e){try{let t="".concat(e,"_timestamp");localStorage.removeItem(e),localStorage.removeItem(t)}catch(e){console.error("Error removing from cache:",e)}}a.d(t,{TK:function(){return s},cW:function(){return n},kI:function(){return r},nZ:function(){return c}})},2203:function(e,t,a){"use strict";a.d(t,{B:function(){return i},v:function(){return l}});var r=a(7437),s=a(2265),n=a(5397),c=a(4683);let o=(0,s.createContext)(void 0);function i(){let e=(0,s.useContext)(o);if(!e)throw Error("useStatsData must be used within a StatsDataProvider");return e}function l(e){let{children:t}=e,a=(0,c.N)(n.Z7,"flouca_stats_gears"),s=(0,c.N)(n.LH,"flouca_stats_ports"),i=(0,c.N)(n.JL,"flouca_stats_regions"),l=(0,c.N)(n.V$,"flouca_stats_coops"),d=(0,c.N)(n.Kh,"flouca_stats_periods"),u=(0,c.N)(n.XZ,"flouca_stats_species"),h=d.data.map(e=>({value:e.period_date,label:"".concat((0,c.f)(e.period_date).split(" ")[0]," ").concat(e.period_status)})),g=async()=>{await Promise.all([a.refetch(),s.refetch(),i.refetch(),l.refetch(),d.refetch(),u.refetch()])},p=a.isLoading||s.isLoading||i.isLoading||l.isLoading||d.isLoading||u.isLoading,m=a.error||s.error||i.error||l.error||d.error||u.error,f=[a.lastFetched,s.lastFetched,i.lastFetched,l.lastFetched,d.lastFetched,u.lastFetched].filter(Boolean),x=f.length>0?Math.max(...f):null,y={gears:a.data,ports:s.data,regions:i.data,coops:l.data,periods:d.data,species:u.data,formattedPeriods:h,isLoading:p,error:m,lastFetched:x,refetch:g};return(0,r.jsx)(o.Provider,{value:y,children:t})}},4683:function(e,t,a){"use strict";a.d(t,{N:function(){return c},f:function(){return n}});var r=a(2265),s=a(6656);let n=e=>{let t=new Date(e);return"".concat(t.getDate().toString().padStart(2,"0"),"-").concat((t.getMonth()+1).toString().padStart(2,"0"),"-").concat(t.getFullYear()," ").concat(t.getHours?t.getHours():""," ").concat(e.includes("T")?e.split("T")[1].split(".")[0].substring(0,5):"").trim()},c=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:36e5,[n,c]=(0,r.useState)([]),[o,i]=(0,r.useState)(!0),[l,d]=(0,r.useState)(null),[u,h]=(0,r.useState)(null),g=async()=>{try{i(!0),d(null),console.log("Fetching fresh data for ".concat(t,"..."));let a=await e();c(a),(0,s.cW)(t,a),h(Date.now()),console.log("Fresh data for ".concat(t," fetched and cached successfully"))}catch(e){console.error("Error fetching data for ".concat(t,":"),e),d("Failed to load ".concat(t," data. Please try again."))}finally{i(!1)}};return(0,r.useEffect)(()=>{(async()=>{let e=(0,s.TK)(t,a);if(e){console.log("Data for ".concat(t," loaded from cache successfully")),c(e);let a=localStorage.getItem("".concat(t,"_timestamp"));h(a?parseInt(a,10):null),i(!1)}else await g()})()},[t]),{data:n,isLoading:o,error:l,lastFetched:u,refetch:g}}},4188:function(e,t,a){"use strict";a.d(t,{x1:function(){return s},zG:function(){return n}});var r=a(8472);let s=r.Z.create({baseURL:"http://localhost:4000",headers:{"Content-Type":"application/json"}}),n=(e,t)=>{if(console.error("Error ".concat(t,":"),e),r.Z.isAxiosError(e)&&e.response){if(console.error("Error response data:",e.response.data),console.error("Error response status:",e.response.status),e.response.data&&"object"==typeof e.response.data)throw{message:e.response.data.message||"Server error (".concat(t,")"),statusCode:e.response.status,details:e.response.data};throw Error("Server error (".concat(e.response.status,"): ").concat(e.message))}throw Error("Failed to ".concat(t,". Please check your connection and try again."))}},5397:function(e,t,a){"use strict";a.d(t,{V$:function(){return l},Z7:function(){return n},Kh:function(){return o},LH:function(){return s},JL:function(){return i},XZ:function(){return c},PF:function(){return u},DE:function(){return d}});var r=a(4188);let s=async()=>{try{return(await r.x1.get("/ports")).data}catch(e){return(0,r.zG)(e,"fetching ports")}},n=async()=>{try{return(await r.x1.get("/api/dev/gear/all/gear")).data}catch(e){return(0,r.zG)(e,"fetching gears")}},c=async()=>{try{return(await r.x1.get("/species/all")).data}catch(e){return(0,r.zG)(e,"fetching species")}},o=async()=>{try{return(await r.x1.get("/api/dev/period/all/period")).data}catch(e){return(0,r.zG)(e,"fetching periods")}},i=async()=>{try{return(await r.x1.get("/region/all")).data}catch(e){return(0,r.zG)(e,"fetching regions")}},l=async()=>{try{return(await r.x1.get("/api/coop/all")).data}catch(e){return(0,r.zG)(e,"fetching coops")}},d=async e=>{try{let t=JSON.parse(JSON.stringify(e));return console.log("Sending landing data to API:",JSON.stringify(t,null,2)),(await r.x1.post("/api/dev/landings/create/form",t)).data}catch(e){return(0,r.zG)(e,"submitting landing form")}},u=async e=>{try{let t=JSON.parse(JSON.stringify(e));return console.log("Sending fleet senses data to API:",JSON.stringify(t,null,2)),(await r.x1.post("/api/dev/fleet_senses/form/create",t)).data}catch(e){return(0,r.zG)(e,"submitting fleet senses form")}}}},function(e){e.O(0,[472,108,971,23,744],function(){return e(e.s=1196)}),_N_E=e.O()}]);