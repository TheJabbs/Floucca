(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[857],{8757:function(e,t,a){Promise.resolve().then(a.bind(a,6662))},6662:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var r=a(7437),o=a(2265),s=a(6314),n=a(4023);let l=e=>new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),c=e=>new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e);var i=e=>{let{title:t,columns:a,data:o,isLoading:s,noDataMessage:n="No data available",keyExtractor:i}=e,d=(e,t)=>{if(e.format)return e.format(t);if("number"==typeof t){if(e.key.toLowerCase().includes("avgprice"))return l(t);if(t%1!=0)return c(t)}return t};return(0,r.jsxs)("div",{children:[t&&(0,r.jsx)("h3",{className:"text-lg font-semibold mb-3",children:t}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsx)("tr",{children:a.map(e=>(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider",children:e.header},e.key))})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:a.length,className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center",children:(0,r.jsx)("div",{className:"flex justify-center py-4",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})})})}):o&&0!==o.length?o.map((e,t)=>(0,r.jsx)("tr",{children:a.map(a=>(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:d(a,e[a.key])},"".concat(t,"-").concat(a.key)))},i?i(e):t)):(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:a.length,className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center",children:n})})})]})})]})},d=e=>{let{isLoading:t,effortData:a}=e;return(0,r.jsx)(i,{title:"Effort (WEEKLY)",columns:[{key:"records",header:"Records"},{key:"gears",header:"Boats/Gears"},{key:"activeDays",header:"Active Days"},{key:"pba",header:"PBA"},{key:"estEffort",header:"Estimated Effort"}],data:a?[a]:[],isLoading:t,noDataMessage:"No effort data available."})},u=e=>{let{isLoading:t,landingsData:a}=e;return(0,r.jsx)(i,{title:"Landings",columns:[{key:"records",header:"Records"},{key:"avgPrice",header:"Average Price"},{key:"estValue",header:"Estimated Value"},{key:"cpue",header:"CPUE"},{key:"estCatch",header:"Estimated Catch"},{key:"sampleEffort",header:"Sample Effort"}],data:a?[a]:[],isLoading:t,noDataMessage:"No landings data available."})},g=a(2807),h=a(5528),m=e=>{let{data:t,isLoading:a}=e,[s,n]=(0,o.useState)("numbOfCatch"),l=e=>null!==e?e.toFixed(2):"N/A",c=e=>null!==e?"".concat(new Intl.NumberFormat("en-US").format(e)," LBP"):"N/A",i={numbOfCatch:{label:"N. Catch",color:"#4f46e5",formatter:l,bgColor:"bg-indigo-100",textColor:"text-indigo-800"},estCatch:{label:"Est. Catch",color:"#a855f7",formatter:l,bgColor:"bg-purple-100",textColor:"text-purple-800"},price:{label:"Price",color:"#10b981",formatter:c,bgColor:"bg-green-100",textColor:"text-green-800"},cpue:{label:"CPUE",color:"#f59e0b",formatter:l,bgColor:"bg-amber-100",textColor:"text-amber-800"},avgWeight:{label:"Avg Weight",color:"#3b82f6",formatter:e=>null!==e?"".concat(e.toFixed(2)," kg"):"N/A",bgColor:"bg-blue-100",textColor:"text-blue-800"},avgQuantity:{label:"Avg Quantity",color:"#ec4899",formatter:l,bgColor:"bg-pink-100",textColor:"text-pink-800"},avgLength:{label:"Avg Length",color:"#14b8a6",formatter:e=>null!==e?"".concat(e.toFixed(2)," cm"):"N/A",bgColor:"bg-teal-100",textColor:"text-teal-800"},avgPrice:{label:"Avg Price",color:"#8b5cf6",formatter:c,bgColor:"bg-violet-100",textColor:"text-violet-800"},value:{label:"Value",color:"#ef4444",formatter:c,bgColor:"bg-red-100",textColor:"text-red-800"},effort:{label:"Effort",color:"#6366f1",formatter:l,bgColor:"bg-indigo-100",textColor:"text-indigo-800"}},d=o.useMemo(()=>({yAxis:[{label:""}],height:400,sx:{[".".concat(h.x.left," .").concat(h.x.label)]:{transform:"translate(-20px, 0)"}}}),[s]);if(a)return(0,r.jsx)("div",{className:"flex justify-center py-10",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"})});if(!t||0===t.length)return(0,r.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg text-gray-500 text-center",children:"No data available for chart visualization"});let{dataset:u,series:m}=(()=>{if(!t||0===t.length)return{dataset:[],series:[]};let e=t.map(e=>({specie_name:e.specie_name,numbOfCatch:e.numbOfCatch,estCatch:e.estCatch,price:e.price,cpue:e.cpue,avgWeight:e.avgWeight,avgQuantity:e.avgQuantity,avgLength:e.avgLength,avgPrice:e.avgPrice,value:e.value,effort:e.effort})),a=i[s];return{dataset:e,series:[{dataKey:s,label:a.label,valueFormatter:a.formatter,color:a.color}]}})();return(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-3 text-center",children:"Species Data Bar Chart"}),(0,r.jsx)("div",{className:"mb-4",children:[{title:"Catch Metrics",metrics:["numbOfCatch","estCatch","cpue","effort","value"]},{title:"Average Metrics",metrics:["avgWeight","avgLength","avgQuantity","avgPrice"]}].map((e,t)=>(0,r.jsxs)("div",{className:"".concat(t>0?"mt-2":""),children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-500 mb-1",children:e.title}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:e.metrics.map(e=>(0,r.jsx)("button",{onClick:()=>n(e),className:"px-3 py-1.5 rounded-md text-sm font-medium ".concat(s===e?"".concat(i[e].bgColor," ").concat(i[e].textColor):"bg-gray-100 text-gray-800 hover:bg-gray-200"),children:i[e].label},e))})]},e.title))}),(0,r.jsx)("div",{className:"mx-auto",style:{width:"100%",maxWidth:"900px"},children:(0,r.jsx)(g.v,{dataset:u,xAxis:[{scaleType:"band",dataKey:"specie_name",tickLabelStyle:{angle:u.length>10?45:0,textAnchor:u.length>10?"start":"middle",fontSize:14}}],series:m,...d})})]})},f=a(3920),x=e=>{let{isLoading:t,statsData:a}=e,[s,n]=(0,o.useState)(!1);return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Fishing Data"}),(0,r.jsxs)("button",{onClick:()=>{n(!s)},className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ".concat(s?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-700 hover:bg-gray-200"),title:s?"Hide chart view":"Show chart view",children:[(0,r.jsx)(f.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:s?"Hide Chart":"View Chart"})]})]}),(0,r.jsx)(i,{columns:[{key:"specie_name",header:"Species"},{key:"numbOfCatch",header:"N. catch"},{key:"avgPrice",header:"Avg. Price"},{key:"avgWeight",header:"Avg.Weight (kg)"},{key:"avgLength",header:"Avg.Length (cm)"},{key:"avgQuantity",header:"Avg. Quantity"},{key:"value",header:"Value"},{key:"cpue",header:"CPUE"},{key:"estCatch",header:"Est. catch"},{key:"effort",header:"Effort"}],data:a,isLoading:t,noDataMessage:"No species data available.",keyExtractor:e=>e.specie_name}),s&&(0,r.jsx)(m,{data:a||[],isLoading:t})]})},p=a(5084);let b=async e=>{try{let t={period:e.period,gear_code:e.gear_code?e.gear_code:void 0,port_id:e.port_id?e.port_id:void 0,region:e.region?e.region:void 0,coop:e.coop?e.coop:void 0};return console.log("Sending filter to API:",t),(await p.x1.post("/api/dev/formulas/report/effort&landing",t)).data}catch(e){return(0,p.zG)(e,"fetching statistics data")}};var v=()=>{let{gears:e,ports:t,formattedPeriods:a,isLoading:l,error:c}=(0,n.B)(),[i,g]=(0,o.useState)(""),[h,m]=(0,o.useState)(0),[f,p]=(0,o.useState)(0),[v,y]=(0,o.useState)({records:0,gears:0,activeDays:0,pba:0,estEffort:0}),[j,N]=(0,o.useState)({records:0,avgPrice:0,estValue:0,cpue:0,estCatch:0,sampleEffort:0,sampleCatch:0}),[w,C]=(0,o.useState)([]),[S,k]=(0,o.useState)(!1),[_,E]=(0,o.useState)(!1),[F,L]=(0,o.useState)(!1),[P,D]=(0,o.useState)(null),A=()=>""!==i&&0!==h&&0!==f,I=async()=>{if(A()){k(!0),E(!0),L(!0),D(null);try{let e=await b({period:i,gear_code:[h],port_id:[f]});y(e.upperTables.effort),N(e.upperTables.landings),C(e.lowerTable)}catch(e){console.error("Error fetching statistics:",e),D("string"==typeof e?e:"Failed to fetch statistics data")}finally{k(!1),E(!1),L(!1)}}};return((0,o.useEffect)(()=>{A()&&I()},[i,h,f]),l)?(0,r.jsx)("div",{className:"flex justify-center py-10",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"})}):c?(0,r.jsx)("div",{className:"container mx-auto p-6",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-800 p-4 rounded-lg",children:[(0,r.jsx)("p",{children:c}),(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-md",children:"Try Again"})]})}):(0,r.jsxs)("div",{className:"container mx-auto p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4 lg:mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Fishing Statistics"}),(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsxs)("button",{onClick:I,disabled:!A(),className:"px-3 py-1.5 rounded-lg flex items-center gap-1 text-sm ".concat(A()?"bg-blue-100 text-blue-800 hover:bg-blue-200":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:[(0,r.jsx)(s.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Refresh Data"})]})})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-4 lg:gap-6",children:[(0,r.jsx)("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"period",className:"block text-sm font-medium text-gray-700 mb-1",children:"Time Period"}),(0,r.jsxs)("select",{id:"period",value:i,onChange:e=>{g(e.target.value)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,r.jsx)("option",{value:"",children:"Select a period"}),[...a].sort((e,t)=>t.value.localeCompare(e.value)).map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"gear",className:"block text-sm font-medium text-gray-700 mb-1",children:"Gear Type"}),(0,r.jsxs)("select",{id:"gear",value:h,onChange:e=>{m(Number(e.target.value))},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,r.jsx)("option",{value:0,children:"Select a gear"}),e.map(e=>(0,r.jsx)("option",{value:e.gear_code,children:e.gear_name},e.gear_code))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"port",className:"block text-sm font-medium text-gray-700 mb-1",children:"Port"}),(0,r.jsxs)("select",{id:"port",value:f,onChange:e=>{p(Number(e.target.value))},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,r.jsx)("option",{value:0,children:"Select a port"}),t.map(e=>(0,r.jsx)("option",{value:e.port_id,children:e.port_name},e.port_id))]})]})]})}),P&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-800 p-4 rounded-lg",children:(0,r.jsx)("p",{children:P})}),A()?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg border shadow-sm overflow-x-auto",children:[(0,r.jsx)(d,{isLoading:S,effortData:v}),(0,r.jsx)("div",{className:"border-t border-gray-300 my-4"}),(0,r.jsx)(u,{isLoading:_,landingsData:j})]}),(0,r.jsx)("div",{className:"bg-white p-4 rounded-lg border shadow-sm overflow-x-auto",children:(0,r.jsx)(x,{isLoading:F,statsData:w})})]}):(0,r.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-100 text-blue-800 text-center",children:"Please select a time period, gear type, and port to view statistics."})]})]})}},4578:function(e,t,a){"use strict";function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36e5;try{let a=localStorage.getItem("".concat(e,"_timestamp"));if(!a)return!1;let r=parseInt(a,10);return Date.now()-r<t}catch(e){return console.error("Error checking cache validity:",e),!1}}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36e5;try{if(!r(e,t))return null;let a=localStorage.getItem(e);if(!a)return null;return JSON.parse(a)}catch(e){return console.error("Error retrieving from cache:",e),null}}function s(e,t){try{let a="".concat(e,"_timestamp");localStorage.setItem(e,JSON.stringify(t)),localStorage.setItem(a,Date.now().toString())}catch(e){console.error("Error saving to cache:",e)}}function n(e){try{let t="".concat(e,"_timestamp");localStorage.removeItem(e),localStorage.removeItem(t)}catch(e){console.error("Error removing from cache:",e)}}a.d(t,{TK:function(){return o},cW:function(){return s},kI:function(){return r},nZ:function(){return n}})},4023:function(e,t,a){"use strict";a.d(t,{B:function(){return c},v:function(){return i}});var r=a(7437),o=a(2265),s=a(5108),n=a(3301);let l=(0,o.createContext)(void 0);function c(){let e=(0,o.useContext)(l);if(!e)throw Error("useStatsData must be used within a StatsDataProvider");return e}function i(e){let{children:t}=e,a=(0,n.N)(s.Z7,"flouca_stats_gears"),o=(0,n.N)(s.LH,"flouca_stats_ports"),c=(0,n.N)(s.JL,"flouca_stats_regions"),i=(0,n.N)(s.V$,"flouca_stats_coops"),d=(0,n.N)(s.Kh,"flouca_stats_periods"),u=d.data.map(e=>({value:e.period_date,label:"".concat((0,n.f)(e.period_date).split(" ")[0]," ").concat(e.period_status)})),g=async()=>{await Promise.all([a.refetch(),o.refetch(),c.refetch(),i.refetch(),d.refetch()])},h=a.isLoading||o.isLoading||c.isLoading||i.isLoading||d.isLoading,m=a.error||o.error||c.error||i.error||d.error,f=[a.lastFetched,o.lastFetched,c.lastFetched,i.lastFetched,d.lastFetched].filter(Boolean),x=f.length>0?Math.max(...f):null,p={gears:a.data,ports:o.data,regions:c.data,coops:i.data,periods:d.data,formattedPeriods:u,isLoading:h,error:m,lastFetched:x,refetch:g};return(0,r.jsx)(l.Provider,{value:p,children:t})}},3301:function(e,t,a){"use strict";a.d(t,{N:function(){return n},f:function(){return s}});var r=a(2265),o=a(4578);let s=e=>{let t=new Date(e);return"".concat(t.getDate().toString().padStart(2,"0"),"-").concat((t.getMonth()+1).toString().padStart(2,"0"),"-").concat(t.getFullYear()," ").concat(t.getHours?t.getHours():""," ").concat(e.includes("T")?e.split("T")[1].split(".")[0].substring(0,5):"").trim()},n=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:36e5,[s,n]=(0,r.useState)([]),[l,c]=(0,r.useState)(!0),[i,d]=(0,r.useState)(null),[u,g]=(0,r.useState)(null),h=async()=>{try{c(!0),d(null),console.log("Fetching fresh data for ".concat(t,"..."));let a=await e();n(a),(0,o.cW)(t,a),g(Date.now()),console.log("Fresh data for ".concat(t," fetched and cached successfully"))}catch(e){console.error("Error fetching data for ".concat(t,":"),e),d("Failed to load ".concat(t," data. Please try again."))}finally{c(!1)}};return(0,r.useEffect)(()=>{(async()=>{let e=(0,o.TK)(t,a);if(e){console.log("Data for ".concat(t," loaded from cache successfully")),n(e);let a=localStorage.getItem("".concat(t,"_timestamp"));g(a?parseInt(a,10):null),c(!1)}else await h()})()},[t]),{data:s,isLoading:l,error:i,lastFetched:u,refetch:h}}},5084:function(e,t,a){"use strict";a.d(t,{x1:function(){return o},zG:function(){return s}});var r=a(3464);let o=r.Z.create({baseURL:"http://localhost:4000",headers:{"Content-Type":"application/json"}}),s=(e,t)=>{if(console.error("Error ".concat(t,":"),e),r.Z.isAxiosError(e)&&e.response){if(console.error("Error response data:",e.response.data),console.error("Error response status:",e.response.status),e.response.data&&"object"==typeof e.response.data)throw{message:e.response.data.message||"Server error (".concat(t,")"),statusCode:e.response.status,details:e.response.data};throw Error("Server error (".concat(e.response.status,"): ").concat(e.message))}throw Error("Failed to ".concat(t,". Please check your connection and try again."))}},5108:function(e,t,a){"use strict";a.d(t,{V$:function(){return i},Z7:function(){return s},Kh:function(){return l},LH:function(){return o},JL:function(){return c},XZ:function(){return n},PF:function(){return u},DE:function(){return d}});var r=a(5084);let o=async()=>{try{return(await r.x1.get("/ports")).data}catch(e){return(0,r.zG)(e,"fetching ports")}},s=async()=>{try{return(await r.x1.get("/api/dev/gear/all/gear")).data}catch(e){return(0,r.zG)(e,"fetching gears")}},n=async()=>{try{return(await r.x1.get("/species/all")).data}catch(e){return(0,r.zG)(e,"fetching species")}},l=async()=>{try{return(await r.x1.get("/api/dev/period/all/period")).data}catch(e){return(0,r.zG)(e,"fetching periods")}},c=async()=>{try{return(await r.x1.get("/region/all")).data}catch(e){return(0,r.zG)(e,"fetching regions")}},i=async()=>{try{return(await r.x1.get("/api/coop/all")).data}catch(e){return(0,r.zG)(e,"fetching coops")}},d=async e=>{try{let t=JSON.parse(JSON.stringify(e));return console.log("Sending landing data to API:",JSON.stringify(t,null,2)),(await r.x1.post("/api/dev/landings/create/form",t)).data}catch(e){return(0,r.zG)(e,"submitting landing form")}},u=async e=>{try{let t=JSON.parse(JSON.stringify(e));return console.log("Sending fleet senses data to API:",JSON.stringify(t,null,2)),(await r.x1.post("/api/dev/fleet_senses/form/create",t)).data}catch(e){return(0,r.zG)(e,"submitting fleet senses form")}}}},function(e){e.O(0,[464,677,971,117,744],function(){return e(e.s=8757)}),_N_E=e.O()}]);