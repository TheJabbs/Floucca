(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[351],{48729:function(e,t,a){Promise.resolve().then(a.bind(a,20504))},20504:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return C}});var r=a(57437),l=a(2265),s=a(66314),o=a(34023),i=a(93243),n=e=>{let{isLoading:t,effortData:a}=e;return(0,r.jsx)(i.Z,{title:"Effort (WEEKLY)",columns:[{key:"records",header:"Records"},{key:"gears",header:"Gears"},{key:"activeDays",header:"Active Days"},{key:"pba",header:"PBA"},{key:"estEffort",header:"Estimated Effort"}],data:a?[a]:[],isLoading:t,noDataMessage:"No effort data available."})},c=e=>{let{isLoading:t,landingsData:a}=e;return(0,r.jsx)(i.Z,{title:"Landings",columns:[{key:"records",header:"Records"},{key:"avgPrice",header:"Average Price"},{key:"estValue",header:"Estimated Value"},{key:"cpue",header:"CPUE"},{key:"estCatch",header:"Estimated Catch"},{key:"sampleCatch",header:"Sample Catch"}],data:a?[a]:[],isLoading:t,noDataMessage:"No landings data available."})},d=a(47625),g=a(77031),h=a(56940),m=a(97059),u=a(62994),x=a(8147),b=a(22190),f=a(83046),p=e=>{let{data:t,isLoading:a}=e,[s,o]=(0,l.useState)("numbOfCatch"),i=e=>null!==e?e.toFixed(2):"N/A",n=e=>null!==e?"".concat(new Intl.NumberFormat("en-US").format(e)," LBP"):"N/A",c={numbOfCatch:{label:"N. Catch",color:"#4f46e5",formatter:i,bgColor:"bg-indigo-100",textColor:"text-indigo-800"},estCatch:{label:"Est. Catch",color:"#a855f7",formatter:i,bgColor:"bg-purple-100",textColor:"text-purple-800"},price:{label:"Price",color:"#10b981",formatter:n,bgColor:"bg-green-100",textColor:"text-green-800"},cpue:{label:"CPUE",color:"#f59e0b",formatter:i,bgColor:"bg-amber-100",textColor:"text-amber-800"},avgWeight:{label:"Avg Weight",color:"#3b82f6",formatter:e=>null!==e?"".concat(e.toFixed(2)," kg"):"N/A",bgColor:"bg-blue-100",textColor:"text-blue-800"},avgQuantity:{label:"Avg Quantity",color:"#ec4899",formatter:i,bgColor:"bg-pink-100",textColor:"text-pink-800"},avgLength:{label:"Avg Length",color:"#14b8a6",formatter:e=>null!==e?"".concat(e.toFixed(2)," cm"):"N/A",bgColor:"bg-teal-100",textColor:"text-teal-800"},avgPrice:{label:"Avg Price",color:"#8b5cf6",formatter:n,bgColor:"bg-violet-100",textColor:"text-violet-800"},value:{label:"Value",color:"#ef4444",formatter:n,bgColor:"bg-red-100",textColor:"text-red-800"},effort:{label:"Effort",color:"#6366f1",formatter:i,bgColor:"bg-indigo-100",textColor:"text-indigo-800"}};if(a)return(0,r.jsx)("div",{className:"flex justify-center py-10",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"})});if(!t||0===t.length)return(0,r.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg text-gray-500 text-center",children:"No data available for chart visualization"});let p=t&&0!==t.length?t.map(e=>({specie_name:e.specie_name,[s]:e[s]})):[];return(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-3 text-center",children:"Species Data Bar Chart"}),(0,r.jsx)("div",{className:"mb-4",children:[{title:"Catch Metrics",metrics:["numbOfCatch","estCatch","cpue","effort","value"]},{title:"Average Metrics",metrics:["avgWeight","avgLength","avgQuantity","avgPrice"]}].map((e,t)=>(0,r.jsxs)("div",{className:"".concat(t>0?"mt-2":""),children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-500 mb-1",children:e.title}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:e.metrics.map(e=>(0,r.jsx)("button",{onClick:()=>o(e),className:"px-3 py-1.5 rounded-md text-sm font-medium ".concat(s===e?"".concat(c[e].bgColor," ").concat(c[e].textColor):"bg-gray-100 text-gray-800 hover:bg-gray-200"),children:c[e].label},e))})]},e.title))}),(0,r.jsx)("div",{className:"mx-auto mt-10",style:{width:"100%",maxWidth:"900px",height:400},children:(0,r.jsx)(d.h,{width:"100%",height:"100%",children:(0,r.jsxs)(g.v,{data:p,margin:{top:20,right:30,left:20,bottom:70},children:[(0,r.jsx)(h.q,{strokeDasharray:"3 3"}),(0,r.jsx)(m.K,{dataKey:"specie_name",angle:p.length>10?-45:0,textAnchor:p.length>10?"end":"middle",height:p.length>10?100:60,interval:0,tick:{fontSize:12}}),(0,r.jsx)(u.B,{}),(0,r.jsx)(x.u,{content:(0,r.jsx)(e=>{let{active:t,payload:a,label:l}=e;if(t&&a&&a.length){let e=a[0].value,t=c[s].formatter;return(0,r.jsxs)("div",{className:"bg-white p-2 shadow rounded border",children:[(0,r.jsx)("p",{className:"font-semibold",children:l}),(0,r.jsx)("p",{className:"text-sm",children:"".concat(c[s].label,": ").concat(t(e))})]})}return null},{})}),(0,r.jsx)(b.D,{layout:"horizontal",align:"center",wrapperStyle:{marginBottom:30,marginLeft:30}}),(0,r.jsx)(f.$,{dataKey:s,name:c[s].label,fill:c[s].color})]})})})]})},v=a(93920),j=e=>{let{isLoading:t,statsData:a}=e,[s,o]=(0,l.useState)(!1);return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Fishing Data"}),(0,r.jsxs)("button",{onClick:()=>{o(!s)},className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ".concat(s?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-700 hover:bg-gray-200"),title:s?"Hide chart view":"Show chart view",children:[(0,r.jsx)(v.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:s?"Hide Chart":"View Chart"})]})]}),(0,r.jsx)(i.Z,{columns:[{key:"specie_name",header:"Species"},{key:"numbOfCatch",header:"N. catch"},{key:"avgPrice",header:"Avg. Price"},{key:"avgWeight",header:"Avg.Weight (kg)"},{key:"avgLength",header:"Avg.Length (cm)"},{key:"avgQuantity",header:"Avg. Quantity"},{key:"value",header:"Value"},{key:"cpue",header:"CPUE"},{key:"estCatch",header:"Est. catch"},{key:"effort",header:"Effort"}],data:a,isLoading:t,noDataMessage:"No species data available.",keyExtractor:e=>e.specie_name}),s&&(0,r.jsx)(p,{data:a||[],isLoading:t})]})},y=a(95084);let N=async e=>{try{let t={period:e.period,gear_code:e.gear_code?e.gear_code:void 0,port_id:e.port_id?e.port_id:void 0,region:e.region?e.region:void 0,coop:e.coop?e.coop:void 0};return console.log("Sending filter to API:",t),(await y.x1.post("/api/dev/formulas/report/effort&landing",t)).data}catch(e){return(0,y.zG)(e,"fetching statistics data")}};var C=()=>{let{gears:e,ports:t,formattedPeriods:a,isLoading:i,error:d}=(0,o.B)(),[g,h]=(0,l.useState)(""),[m,u]=(0,l.useState)(0),[x,b]=(0,l.useState)(0),[f,p]=(0,l.useState)({records:0,gears:0,activeDays:0,pba:0,estEffort:0}),[v,y]=(0,l.useState)({records:0,avgPrice:0,estValue:0,cpue:0,estCatch:0,sampleEffort:0,sampleCatch:0}),[C,k]=(0,l.useState)([]),[w,_]=(0,l.useState)(!1),[S,E]=(0,l.useState)(!1),[A,P]=(0,l.useState)(!1),[L,D]=(0,l.useState)(null),F=()=>""!==g&&0!==m&&0!==x,W=async()=>{if(F()){_(!0),E(!0),P(!0),D(null);try{let e=await N({period:g,gear_code:[m],port_id:[x]});p(e.upperTables.effort),y(e.upperTables.landings),k(e.lowerTable)}catch(e){console.error("Error fetching statistics:",e),D("string"==typeof e?e:"Failed to fetch statistics data")}finally{_(!1),E(!1),P(!1)}}};return((0,l.useEffect)(()=>{F()&&W()},[g,m,x]),i)?(0,r.jsx)("div",{className:"flex justify-center py-10",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"})}):d?(0,r.jsx)("div",{className:"container mx-auto p-6",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-800 p-4 rounded-lg",children:[(0,r.jsx)("p",{children:d}),(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-md",children:"Try Again"})]})}):(0,r.jsxs)("div",{className:"container mx-auto p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4 lg:mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Fishing Statistics"}),(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsxs)("button",{onClick:W,disabled:!F(),className:"px-3 py-1.5 rounded-lg flex items-center gap-1 text-sm ".concat(F()?"bg-blue-100 text-blue-800 hover:bg-blue-200":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:[(0,r.jsx)(s.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Refresh Data"})]})})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-4 lg:gap-6",children:[(0,r.jsx)("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"period",className:"block text-sm font-medium text-gray-700 mb-1",children:"Time Period"}),(0,r.jsxs)("select",{id:"period",value:g,onChange:e=>{h(e.target.value)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,r.jsx)("option",{value:"",children:"Select a period"}),[...a].sort((e,t)=>t.value.localeCompare(e.value)).map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"gear",className:"block text-sm font-medium text-gray-700 mb-1",children:"Gear Type"}),(0,r.jsxs)("select",{id:"gear",value:m,onChange:e=>{u(Number(e.target.value))},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,r.jsx)("option",{value:0,children:"Select a gear"}),e.map(e=>(0,r.jsx)("option",{value:e.gear_code,children:e.gear_name},e.gear_code))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"port",className:"block text-sm font-medium text-gray-700 mb-1",children:"Port"}),(0,r.jsxs)("select",{id:"port",value:x,onChange:e=>{b(Number(e.target.value))},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,r.jsx)("option",{value:0,children:"Select a port"}),t.map(e=>(0,r.jsx)("option",{value:e.port_id,children:e.port_name},e.port_id))]})]})]})}),L&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-800 p-4 rounded-lg",children:(0,r.jsx)("p",{children:L})}),F()?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg border shadow-sm overflow-x-auto",children:[(0,r.jsx)(n,{isLoading:w,effortData:f}),(0,r.jsx)("div",{className:"border-t border-gray-300 my-4"}),(0,r.jsx)(c,{isLoading:S,landingsData:v})]}),(0,r.jsx)("div",{className:"bg-white p-4 rounded-lg border shadow-sm overflow-x-auto",children:(0,r.jsx)(j,{isLoading:A,statsData:C})})]}):(0,r.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-100 text-blue-800 text-center",children:"Please select a time period, gear type, and port to view statistics."})]})]})}}},function(e){e.O(0,[464,766,478,103,971,117,744],function(){return e(e.s=48729)}),_N_E=e.O()}]);