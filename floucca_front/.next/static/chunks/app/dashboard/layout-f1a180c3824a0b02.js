(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[663],{20639:function(e,t,r){Promise.resolve().then(r.bind(r,9382))},9382:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return x}});var a=r(57437),s=r(2265),n=r(34023),c=r(96471);let o=(0,c.Z)("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]),l=(0,c.Z)("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]),i=(0,c.Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);var d=r(66314);let u=(0,c.Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),h=(0,c.Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var f=r(44578);let m="flouca_stats_panel";var g=()=>{let[e,t]=(0,s.useState)(!1),[r,n]=(0,s.useState)(!1),[c,g]=(0,s.useState)(null),[x,p]=(0,s.useState)(!0),[y,v]=(0,s.useState)(null),[b,N]=(0,s.useState)({}),[j,w]=(0,s.useState)(null),[S,k]=(0,s.useState)(!1),[_,E]=(0,s.useState)(null),C=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{if(p(!0),v(null),!e){let e=(0,f.TK)(m,9e5);if(e){if(console.log("Using cached stats data"),g(e),(0,f.kI)(m,9e5)){let e=localStorage.getItem("".concat(m,"_timestamp"));E(e?parseInt(e,10):null)}p(!1);let t=Object.keys(e).reduce((e,t)=>(e[t]=!0,e),{});N(t);return}}console.log("Fetching fresh stats data");let t=await fetch("".concat("http://13.37.42.136:4000","/api/dev/formulas/report/leftPanel"));if(!t.ok)throw Error("Failed to fetch statistics");let r=await t.json();g(r),(0,f.cW)(m,r),E(Date.now());let a=Object.keys(r).reduce((e,t)=>(e[t]=!0,e),{});N(a)}catch(e){v(e instanceof Error?e.message:"Unknown error occurred")}finally{p(!1)}};(0,s.useEffect)(()=>{C()},[]);let L=e=>{N(t=>({...t,[e]:!t[e]}))},z=e=>{w(e),k(!1)},D=()=>{C(!0)},F=e=>{let t=new Date(e),r=t.toLocaleString("default",{month:"short"}),a=t.getFullYear();return"".concat(r," ").concat(a)},I=e=>{if(!c||!c[e])return[];let t=c[e];return[{type:"Ports",records:t.strata.port},{type:"Coops",records:t.strata.coop},{type:"Regions",records:t.strata.region},{type:"Species",records:t.speciesKind},{type:"Effort Records",records:t.effortRecord},{type:"Landing Records",records:t.landingRecord},{type:"Total Gears",records:t.totalGears},{type:"Sample Catch",records:t.sampleCatch}]};if(x&&!c&&e)return(0,a.jsx)("div",{className:"bg-white border-r border-gray-200 h-full flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"})});let P=c?Object.keys(c).sort((e,t)=>new Date(t).getTime()-new Date(e).getTime()):[];return(0,a.jsx)("div",{className:"bg-white border-r border-gray-200 h-full overflow-y-auto transition-all duration-300 ".concat(e?"w-64":"w-14"," ").concat(x?"opacity-70":"opacity-100"),onMouseEnter:()=>{r||t(!0)},onMouseLeave:()=>{r||t(!1)},children:(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[!e&&(0,a.jsxs)("div",{className:"flex flex-col items-center p-3",children:[(0,a.jsx)(o,{className:"h-6 w-6 text-blue-600"}),(0,a.jsx)("span",{className:"mt-1 text-xs text-gray-600 font-medium",children:"Stats"})]}),e&&(0,a.jsxs)("div",{className:"flex flex-col h-full p-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(o,{className:"h-5 w-5 text-blue-600 mr-2"}),(0,a.jsx)("h2",{className:"font-semibold text-lg",children:"Statistics"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("button",{onClick:()=>{n(!r),t(!0)},className:"p-1.5 rounded-full hover:bg-gray-100 ".concat(r?"text-blue-600 bg-blue-50":"text-gray-500"),title:r?"Unpin panel":"Pin panel",children:(0,a.jsx)(l,{size:16,className:r?"fill-blue-600":""})}),(0,a.jsx)("button",{onClick:()=>{k(!S)},className:"p-1.5 rounded-full hover:bg-gray-100 text-gray-500",title:"Filter by period",children:(0,a.jsx)(i,{size:16})}),(0,a.jsx)("button",{onClick:D,className:"p-1.5 rounded-full hover:bg-gray-100 text-gray-500",title:"Refresh data",disabled:x,children:(0,a.jsx)(d.Z,{size:16,className:x?"animate-spin":""})})]})]}),_&&(0,a.jsxs)("div",{className:"mb-2 text-xs text-gray-500",children:["Last updated: ",new Date(_).toLocaleString()]}),y&&(0,a.jsxs)("div",{className:"mb-4 p-2 bg-red-50 text-red-700 rounded border border-red-200 text-sm",children:[y,(0,a.jsx)("button",{className:"ml-2 text-red-600 hover:text-red-800 underline text-xs",onClick:D,children:"Retry"})]}),S&&(0,a.jsxs)("div",{className:"mb-4 p-2 bg-gray-50 rounded border",children:[(0,a.jsx)("div",{className:"font-medium mb-2 text-sm",children:"Filter by period:"}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"cursor-pointer p-1 rounded text-sm ".concat(null===j?"bg-blue-100 text-blue-800":"hover:bg-gray-100"),onClick:()=>z(null),children:"All periods"}),P.map(e=>(0,a.jsx)("div",{className:"cursor-pointer p-1 rounded text-sm ".concat(j===e?"bg-blue-100 text-blue-800":"hover:bg-gray-100"),onClick:()=>z(e),children:F(e)},e))]})]}),(0,a.jsx)("div",{className:"flex-grow overflow-y-auto",children:null===j?(0,a.jsx)("div",{className:"space-y-2",children:P.map(e=>(0,a.jsxs)("div",{className:"border rounded overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 bg-blue-50 cursor-pointer",onClick:()=>L(e),children:[(0,a.jsx)("span",{className:"font-semibold text-blue-700",children:F(e)}),b[e]?(0,a.jsx)(u,{size:16,className:"text-blue-700"}):(0,a.jsx)(h,{size:16,className:"text-blue-700"})]}),b[e]&&(0,a.jsx)("div",{className:"border-t",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-3 py-1.5 text-left text-xs font-medium text-gray-500",children:"Data type"}),(0,a.jsx)("th",{className:"px-3 py-1.5 text-right text-xs font-medium text-gray-500",children:"Records"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:I(e).map((t,r)=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-3 py-1.5 text-sm text-gray-700",children:t.type}),(0,a.jsx)("td",{className:"px-3 py-1.5 text-sm text-gray-700 text-right",children:t.records})]},"".concat(e,"-").concat(t.type,"-").concat(r)))})]})})]},e))}):(0,a.jsxs)("div",{className:"border rounded overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-blue-50 p-2",children:(0,a.jsx)("span",{className:"font-semibold text-blue-700",children:F(j)})}),(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-3 py-1.5 text-left text-xs font-medium text-gray-500",children:"Data type"}),(0,a.jsx)("th",{className:"px-3 py-1.5 text-right text-xs font-medium text-gray-500",children:"Records"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:I(j).map((e,t)=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-3 py-1.5 text-sm text-gray-700",children:e.type}),(0,a.jsx)("td",{className:"px-3 py-1.5 text-sm text-gray-700 text-right",children:e.records})]},t))})]})]})})]})]})})};function x(e){let{children:t}=e;return(0,a.jsx)(n.v,{children:(0,a.jsxs)("div",{className:"flex h-full",children:[(0,a.jsx)("div",{className:"flex h-screen",children:(0,a.jsx)(g,{})}),(0,a.jsx)("div",{className:"flex-1 p-6 overflow-y-auto",children:t})]})})}},44578:function(e,t,r){"use strict";function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36e5;try{let r=localStorage.getItem("".concat(e,"_timestamp"));if(!r)return!1;let a=parseInt(r,10);return Date.now()-a<t}catch(e){return console.error("Error checking cache validity:",e),!1}}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36e5;try{if(!a(e,t))return null;let r=localStorage.getItem(e);if(!r)return null;return JSON.parse(r)}catch(e){return console.error("Error retrieving from cache:",e),null}}function n(e,t){try{let r="".concat(e,"_timestamp");localStorage.setItem(e,JSON.stringify(t)),localStorage.setItem(r,Date.now().toString())}catch(e){console.error("Error saving to cache:",e)}}function c(e){try{let t="".concat(e,"_timestamp");localStorage.removeItem(e),localStorage.removeItem(t)}catch(e){console.error("Error removing from cache:",e)}}r.d(t,{TK:function(){return s},cW:function(){return n},kI:function(){return a},nZ:function(){return c}})},34023:function(e,t,r){"use strict";r.d(t,{B:function(){return l},v:function(){return i}});var a=r(57437),s=r(2265),n=r(5108),c=r(53301);let o=(0,s.createContext)(void 0);function l(){let e=(0,s.useContext)(o);if(!e)throw Error("useStatsData must be used within a StatsDataProvider");return e}function i(e){let{children:t}=e,r=(0,c.N)(n.Z7,"flouca_stats_gears"),s=(0,c.N)(n.LH,"flouca_stats_ports"),l=(0,c.N)(n.JL,"flouca_stats_regions"),i=(0,c.N)(n.V$,"flouca_stats_coops"),d=(0,c.N)(n.Kh,"flouca_stats_periods"),u=d.data.map(e=>({value:e.period_date,label:"".concat((0,c.f)(e.period_date).split(" ")[0]," ").concat(e.period_status)})),h=async()=>{await Promise.all([r.refetch(),s.refetch(),l.refetch(),i.refetch(),d.refetch()])},f=r.isLoading||s.isLoading||l.isLoading||i.isLoading||d.isLoading,m=r.error||s.error||l.error||i.error||d.error,g=[r.lastFetched,s.lastFetched,l.lastFetched,i.lastFetched,d.lastFetched].filter(Boolean),x=g.length>0?Math.max(...g):null,p={gears:r.data,ports:s.data,regions:l.data,coops:i.data,periods:d.data,formattedPeriods:u,isLoading:f,error:m,lastFetched:x,refetch:h};return(0,a.jsx)(o.Provider,{value:p,children:t})}},53301:function(e,t,r){"use strict";r.d(t,{N:function(){return c},f:function(){return n}});var a=r(2265),s=r(44578);let n=e=>{let t=new Date(e);return"".concat(t.getDate().toString().padStart(2,"0"),"-").concat((t.getMonth()+1).toString().padStart(2,"0"),"-").concat(t.getFullYear()," ").concat(t.getHours?t.getHours():""," ").concat(e.includes("T")?e.split("T")[1].split(".")[0].substring(0,5):"").trim()},c=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:36e5,[n,c]=(0,a.useState)([]),[o,l]=(0,a.useState)(!0),[i,d]=(0,a.useState)(null),[u,h]=(0,a.useState)(null),f=async()=>{try{l(!0),d(null),console.log("Fetching fresh data for ".concat(t,"..."));let r=await e();c(r),(0,s.cW)(t,r),h(Date.now()),console.log("Fresh data for ".concat(t," fetched and cached successfully"))}catch(e){console.error("Error fetching data for ".concat(t,":"),e),d("Failed to load ".concat(t," data. Please try again."))}finally{l(!1)}};return(0,a.useEffect)(()=>{(async()=>{let e=(0,s.TK)(t,r);if(e){console.log("Data for ".concat(t," loaded from cache successfully")),c(e);let r=localStorage.getItem("".concat(t,"_timestamp"));h(r?parseInt(r,10):null),l(!1)}else await f()})()},[t]),{data:n,isLoading:o,error:i,lastFetched:u,refetch:f}}},95084:function(e,t,r){"use strict";r.d(t,{x1:function(){return n},zG:function(){return c}});var a=r(83464);let s="http://13.37.42.136:4000";if(!s)throw Error("NEXT_PUBLIC_API_URL is not defined. Please check your .env file and build process.");let n=a.Z.create({baseURL:s,headers:{"Content-Type":"application/json"}}),c=(e,t)=>{if(console.error("Error ".concat(t,":"),e),a.Z.isAxiosError(e)&&e.response){if(console.error("Error response data:",e.response.data),console.error("Error response status:",e.response.status),e.response.data&&"object"==typeof e.response.data)throw{message:e.response.data.message||"Server error (".concat(t,")"),statusCode:e.response.status,details:e.response.data};throw Error("Server error (".concat(e.response.status,"): ").concat(e.message))}throw Error("Failed to ".concat(t,". Please check your connection and try again."))}},5108:function(e,t,r){"use strict";r.d(t,{V$:function(){return i},Z7:function(){return n},Kh:function(){return o},LH:function(){return s},JL:function(){return l},XZ:function(){return c},PF:function(){return u},DE:function(){return d}});var a=r(95084);let s=async()=>{try{return(await a.x1.get("/ports")).data}catch(e){return(0,a.zG)(e,"fetching ports")}},n=async()=>{try{return(await a.x1.get("/api/dev/gear/all/gear")).data}catch(e){return(0,a.zG)(e,"fetching gears")}},c=async()=>{try{return(await a.x1.get("/species/all")).data}catch(e){return(0,a.zG)(e,"fetching species")}},o=async()=>{try{return(await a.x1.get("/api/dev/period/all/period")).data}catch(e){return(0,a.zG)(e,"fetching periods")}},l=async()=>{try{return(await a.x1.get("/region/all")).data}catch(e){return(0,a.zG)(e,"fetching regions")}},i=async()=>{try{return(await a.x1.get("/api/coop/all")).data}catch(e){return(0,a.zG)(e,"fetching coops")}},d=async e=>{try{let t=JSON.parse(JSON.stringify(e));return console.log("Sending landing data to API:",JSON.stringify(t,null,2)),(await a.x1.post("/api/dev/landings/create/form",t)).data}catch(e){return(0,a.zG)(e,"submitting landing form")}},u=async e=>{try{let t=JSON.parse(JSON.stringify(e));return console.log("Sending fleet senses data to API:",JSON.stringify(t,null,2)),(await a.x1.post("/api/dev/fleet_senses/form/create",t)).data}catch(e){return(0,a.zG)(e,"submitting fleet senses form")}}},96471:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var a=r(2265);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:o=2,absoluteStrokeWidth:l,className:i="",children:d,iconNode:u,...h}=e;return(0,a.createElement)("svg",{ref:t,...c,width:s,height:s,stroke:r,strokeWidth:l?24*Number(o)/Number(s):o,className:n("lucide",i),...h},[...u.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),l=(e,t)=>{let r=(0,a.forwardRef)((r,c)=>{let{className:l,...i}=r;return(0,a.createElement)(o,{ref:c,iconNode:t,className:n("lucide-".concat(s(e)),l),...i})});return r.displayName="".concat(e),r}},66314:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(96471).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}},function(e){e.O(0,[464,971,117,744],function(){return e(e.s=20639)}),_N_E=e.O()}]);