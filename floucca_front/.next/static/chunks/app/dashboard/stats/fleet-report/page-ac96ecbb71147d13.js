(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[181],{14544:function(e,t,r){Promise.resolve().then(r.bind(r,56817))},56817:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var a=r(57437),s=r(2265),l=r(66314),o=r(34023),n=r(95084);let c=async e=>{try{return console.log("Sending fleet report filter to API:",e),(await n.x1.post("/api/dev/fleet_senses/report",e)).data}catch(e){return(0,n.zG)(e,"fetching fleet report")}};var d=r(93243),i=e=>{let{data:t,isLoading:r,activeTab:l,setActiveTab:o}=e,n=e=>e.map(e=>{let t={key:"".concat(e.gear_code,"-").concat(e.gear_name.replace(/\s+/g,"-")),gear_code:e.gear_code,gear_name:e.gear_name};return["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"].forEach(r=>{if(e[r]){let a=e[r];t[r]="frequency"===l?a.freq:a.activeDays}else t[r]="0"}),t}),c=(0,s.useMemo)(()=>n(t),[t,l]),i=(0,s.useMemo)(()=>[{key:"gear_name",header:"GEAR"},{key:"jan",header:"JAN"},{key:"feb",header:"FEB"},{key:"mar",header:"MAR"},{key:"apr",header:"APR"},{key:"may",header:"MAY"},{key:"jun",header:"JUN"},{key:"jul",header:"JUL"},{key:"aug",header:"AUG"},{key:"sep",header:"SEP"},{key:"oct",header:"OCT"},{key:"nov",header:"NOV"},{key:"dec",header:"DEC"}],[]);return 0!==t.length||r?(0,a.jsxs)("div",{className:"bg-white rounded-lg border shadow-sm overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-4 border-b",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Fleet Gear Usage"}),(0,a.jsxs)("div",{className:"flex border rounded-md overflow-hidden",children:[(0,a.jsx)("button",{onClick:()=>o("frequency"),className:"px-4 py-2 text-sm font-medium ".concat("frequency"===l?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:"Frequency"}),(0,a.jsx)("button",{onClick:()=>o("activeDays"),className:"px-4 py-2 text-sm font-medium ".concat("activeDays"===l?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:"Active Days"})]})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"frequency"===l?"Showing frequency of gear usage per month":"Showing active days of gear usage per month"})]}),(0,a.jsx)(d.Z,{columns:i,data:c,isLoading:r,noDataMessage:"No gear usage data available. Please select filters and generate the report.",keyExtractor:e=>e.key})]}):(0,a.jsxs)("div",{className:"bg-white rounded-lg border shadow-sm overflow-x-auto",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold p-4 border-b",children:"Fleet Gear Usage"}),(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:"No gear usage data available. Please select filters and generate the report."})]})},u=()=>{let{ports:e,regions:t,coops:r,isLoading:n,error:d}=(0,o.B)(),[u,g]=(0,s.useState)(new Date().getFullYear().toString()),[m,h]=(0,s.useState)("port"),[x,b]=(0,s.useState)([]),[p,y]=(0,s.useState)([]),[f,v]=(0,s.useState)([]),[j,N]=(0,s.useState)([]),[w,k]=(0,s.useState)(!1),[_,C]=(0,s.useState)(null),[S,A]=(0,s.useState)("frequency"),E=new Date().getFullYear(),q=Array.from({length:11},(e,t)=>E-t),D=e=>{x.includes(e)?b(x.filter(t=>t!==e)):b([...x,e])},R=e=>{p.includes(e)?y(p.filter(t=>t!==e)):y([...p,e])},F=e=>{f.includes(e)?v(f.filter(t=>t!==e)):v([...f,e])},M=()=>{if(!u)return!1;switch(m){case"port":return x.length>0;case"region":return p.length>0;case"coop":return f.length>0;default:return!1}},L=e=>{let t=new Map;return e.forEach(e=>{t.has(e.gear_code)||t.set(e.gear_code,{gear_code:e.gear_code,gear_name:e.gear_name});let r={1:"jan",2:"feb",3:"mar",4:"apr",5:"may",6:"jun",7:"jul",8:"aug",9:"sep",10:"oct",11:"nov",12:"dec"}[e.month];r&&(t.get(e.gear_code)[r]={freq:e.freq,activeDays:e.activeDays})}),Array.from(t.values())},P=async()=>{if(M()){k(!0),C(null);try{let e=await c({period:u,port_id:"port"===m?x:void 0,coop:"coop"===m?f:void 0,region:"region"===m?p:void 0}),t=L(e);N(t)}catch(e){console.error("Error fetching fleet report:",e),C("string"==typeof e?e:"Failed to fetch fleet report data")}finally{k(!1)}}};return n?(0,a.jsx)("div",{className:"flex justify-center py-10",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"})}):d?(0,a.jsx)("div",{className:"container mx-auto p-6",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-800 p-4 rounded-lg",children:[(0,a.jsx)("p",{children:d}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-md",children:"Try Again"})]})}):(0,a.jsxs)("div",{className:"container mx-auto p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Fleet Gear Usage Report"}),(0,a.jsxs)("button",{onClick:P,disabled:!M(),className:"px-3 py-2 rounded-lg flex items-center gap-1 text-sm bg-blue-600 hover:bg-blue-700 text-white",children:[(0,a.jsx)(l.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Refresh Data"})]})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg border shadow-sm mb-6",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"w-full md:w-1/3",children:[(0,a.jsx)("label",{htmlFor:"year",className:"block text-sm font-medium text-gray-700 mb-1",children:"Year:"}),(0,a.jsxs)("select",{id:"year",value:u,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"Select a year"}),q.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Filter By:"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>h("port"),className:"px-3 py-2 rounded-lg text-sm font-medium ".concat("port"===m?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"by Port"}),(0,a.jsx)("button",{type:"button",onClick:()=>h("region"),className:"px-3 py-2 rounded-lg text-sm font-medium ".concat("region"===m?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"by Region"}),(0,a.jsx)("button",{type:"button",onClick:()=>h("coop"),className:"px-3 py-2 rounded-lg text-sm font-medium ".concat("coop"===m?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"by Cooperative"})]})]})]}),"port"===m&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Ports:"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:e.map(e=>(0,a.jsx)("button",{onClick:()=>D(e.port_id),className:"px-3 py-1 text-sm rounded-lg border ".concat(x.includes(e.port_id)?"bg-blue-100 border-blue-500 text-blue-800":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"),children:e.port_name},e.port_id))})]}),"region"===m&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Regions:"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:t.map(e=>(0,a.jsx)("button",{onClick:()=>R(e.region_code),className:"px-3 py-1 text-sm rounded-lg border ".concat(p.includes(e.region_code)?"bg-blue-100 border-blue-500 text-blue-800":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"),children:e.region_name},e.region_code))})]}),"coop"===m&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Cooperatives:"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:r.map(e=>(0,a.jsx)("button",{onClick:()=>F(e.coop_code),className:"px-3 py-1 text-sm rounded-lg border ".concat(f.includes(e.coop_code)?"bg-blue-100 border-blue-500 text-blue-800":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"),children:e.coop_name},e.coop_code))})]}),(0,a.jsx)("div",{className:"mt-6 flex justify-end",children:(0,a.jsx)("button",{onClick:P,disabled:!M(),className:"px-4 py-2 rounded-lg text-white font-medium ".concat(M()?"bg-blue-600 hover:bg-blue-700":"bg-gray-300 cursor-not-allowed"),children:"Generate Report"})})]}),_&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-800 p-4 rounded-lg mb-6",children:(0,a.jsx)("p",{children:_})}),(0,a.jsx)(i,{data:j,isLoading:w,activeTab:S,setActiveTab:A})]})}},96471:function(e,t,r){"use strict";r.d(t,{Z:function(){return c}});var a=r(2265);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:n=2,absoluteStrokeWidth:c,className:d="",children:i,iconNode:u,...g}=e;return(0,a.createElement)("svg",{ref:t,...o,width:s,height:s,stroke:r,strokeWidth:c?24*Number(n)/Number(s):n,className:l("lucide",d),...g},[...u.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(i)?i:[i]])}),c=(e,t)=>{let r=(0,a.forwardRef)((r,o)=>{let{className:c,...d}=r;return(0,a.createElement)(n,{ref:o,iconNode:t,className:l("lucide-".concat(s(e)),c),...d})});return r.displayName="".concat(e),r}},66314:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(96471).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}},function(e){e.O(0,[464,103,971,117,744],function(){return e(e.s=14544)}),_N_E=e.O()}]);